@using Comun.DTO.Solicitud
@{
    ViewData["Title"] = "Registro";
    Layout = null;
    string codigo = "";
}
@if (ViewData["ObjCodigo"] != null)
{
    codigo = (string)ViewData["ObjCodigo"];    
}

@* @{
    var documentosRequeridos = ViewData["DocumentosRequeridos"] as List<Respuesta_Consulta_Documentos_Requeridos> ?? new List<Respuesta_Consulta_Documentos_Requeridos>();   
} *@

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de Préstamo</title>   
    <link href="~/css/styles.css" rel="stylesheet" />
    <link href="~/css/animate.min.css" rel="stylesheet" />
    <link href="~/lib/soliciud/css/registro.css" rel="stylesheet" />
    <!-- CSS Styles -->
    <link href="~/css/carguedocumentos.css" rel="stylesheet" />
</head>
<body>
    <div class="video-background">
        <video autoplay muted loop>
            <source src="~/img/videos/1.mp4" type="video/mp4">
        </video>
    </div>

    <div class="container py-5">
        <!-- Header agregado -->
        <div class="header-image text-center mb-4 animate__animated animate__fadeIn">
            <h1 class="display-4">Solicitud de Préstamo</h1>
            <p class="lead">Complete el formulario para iniciar su solicitud</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow-lg main-container">
                    <div class="card-body p-4">
                        <!-- El resto del contenido del formulario permanece igual -->
                        <div class="wizard-steps mb-4">
                            <div class="step active" data-step="1">1</div>
                            <div class="step" data-step="2">2</div>
                            <div class="step" data-step="3">3</div>
                            <div class="step" data-step="4">4</div>
                        </div>

                        <form id="loanForm" class="needs-validation" novalidate>
                            <!-- Paso 1: Información Personal -->
                            <div class="form-section active" id="step1">
                                <h3 class="mb-4 border-bottom pb-2">Información Personal</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="pNombre" required placeholder=" ">
                                            <label for="pNombre">Primer Nombre*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="sNombre" placeholder=" ">
                                            <label for="sNombre">Segundo Nombre</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="pApellido" required placeholder=" ">
                                            <label for="pApellido">Primer Apellido*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="sApellido" placeholder=" ">
                                            <label for="sApellido">Segundo Apellido</label>
                                        </div>
                                    </div>                                   

                                    <div class="col-md-6 ">                                       
                                        <div class="floating-select">                                           
                                            @* @Html.DropDownList("listTipoDocumentos", null, String.Format("Tipo de documento"), htmlAttributes: new { @tabindex = 5, @class = "form-select", style = "width: 100%;", @id = "listTipoDocumentos", required = "true"}) *@
                                            @Html.DropDownList("listTipoDocumentos", null, String.Format("Seleccione ..."), htmlAttributes: new { @tabindex = 5, @class = "form-select", style = "width: 100%;padding-top:6px !important;padding-bottom: 6px !important;", @id = "listTipoDocumentos", required = "true" })
                                            <label for="listTipoDocumentos">Tipo de documento</label>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="number" class="form-control" id="identificacion" placeholder=" " required>
                                            <label for="identificacion">Identificacion</label>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <!-- Paso 2: Información de Contacto y Ubicación -->
                            <div class="form-section" id="step2">
                                <h3 class="mb-4 border-bottom pb-2">Contacto y Ubicación</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="email" class="form-control" id="email" required placeholder=" ">
                                            <label for="email">Correo Electrónico*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="floating-label">
                                            <input type="tel" class="form-control" id="celular" required placeholder=" ">
                                            <label for="celular">Celular*</label>
                                        </div>
                                    </div>                                    

                                    <div class="col-md-6 ">
                                        <div class="floating-select">
                                            @* @Html.DropDownList("ListaDepartamentos", null, String.Format("Departameto de Residencia"), htmlAttributes: new { @tabindex = 9, @class = "form-select", style = "width: 100%;", @id = "ListaDepartamentos", required = "true" })                                            *@
                                            @Html.DropDownList("ListaDepartamentos", null, String.Format("Seleccione ..."), htmlAttributes: new { @tabindex = 5, @class = "form-select", style = "width: 100%;padding-top:6px !important;padding-bottom: 6px !important;", @id = "ListaDepartamentos", required = "true" })
                                            <label for="ListaDepartamentos">Departamento de residencia</label>
                                        </div>
                                    </div>



                                    <div class="col-md-6" id="cajaMunicipio">
                                        <div class="floating-select">
                                            @* @Html.DropDownList("ListaMunicipios", new List<SelectListItem> { new SelectListItem { Text = "Seleccione ...", Value = "0" } }, htmlAttributes: new { @tabindex = 10, @id = "ListaMunicipios", @class = "form-select", style = "width: 100%;", required = "true" }) *@
                                            @Html.DropDownList("ListaMunicipios", new List<SelectListItem> { new SelectListItem { Text = "Seleccione ...", Value = "" } }, htmlAttributes: new { @tabindex = 5, @class = "form-select", style = "width: 100%;padding-top:6px !important;padding-bottom: 6px !important;", @id = "ListaMunicipios", required = "true" })
                                            <label for="ListaMunicipios">Municipio de residencia</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6" id="cajaMunicipio">
                                        <div class="floating-select">
                                            @* @Html.DropDownList("ListaBarrios", new List<SelectListItem> { new SelectListItem { Text = "Barrio de Residencia", Value = "0" } }, htmlAttributes: new { @tabindex = 10, @id = "ListaBarrios", @class = "form-select", style = "width: 100%;", required = "true" }) *@
                                            @Html.DropDownList("ListaBarrios", new List<SelectListItem> { new SelectListItem { Text = "Seleccione ...", Value = "" } }, htmlAttributes: new { @tabindex = 10, @class = "form-select", style = "width: 100%;padding-top:6px !important;padding-bottom: 6px !important;", @id = "ListaBarrios", required = "true" })
                                            <label for="ListaBarrios">Barrio de residencia</label>
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="direccion" required placeholder=" ">
                                            <label for="direccion">Dirección de Residencia</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Paso 3: Información Financiera -->
                            <div class="form-section" id="step3">
                                <h3 class="mb-4 border-bottom pb-2">Información Financiera</h3>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="floating-select">
                                            @Html.DropDownList("EntidadBancaria",
                                                     ViewBag.ListaEntidadesBancarias as SelectList,
                                                     "Entidad Bancaria",
                                                     htmlAttributes: new
                                                     {
                                                         @class = "form-select form-select-sm",
                                                         @id = "entidadBancaria",
                                                         required = "required"
                                                     })
                                            <label for="entidadBancaria">Entidad Bancaria</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="floating-select">
                                            @Html.DropDownList("TipoCuenta",
                                                     ViewBag.ListaTiposCuenta as SelectList,
                                                     "Tipo de Cuenta",
                                                     htmlAttributes: new
                                                     {
                                                         @class = "form-select form-select-sm",
                                                         @id = "tipoCuenta",
                                                         required = "required"
                                                     })
                                            <label for="tipoCuenta">Tipo de Cuenta</label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="numeroCuenta" required placeholder=" ">
                                            <label for="numeroCuenta">Número de Cuenta*</label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="codigoAcceso" required placeholder=" " value="@codigo" disabled>
                                            <label for="codigoAcceso">Código de Acceso*</label>
                                        </div>
                                    </div>

                                    <div class="col-6">
                                        <div class="floating-label">
                                            <input type="text" class="form-control" id="montoSolicitado" required>
                                            <label for="numeroCuenta">Monto Solicitado*</label>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input is-invalid" type="checkbox" id="tratamientoDatos" value="0" required>
                                            <label class="form-check-label" for="tratamientoDatos" id="labelTratamientoDatos">
                                                Acepto el tratamiento de mis datos personales
                                            </label>
                                        </div>
                                    </div> 
                                </div>
                            </div>

                            <!-- Paso 4: Documentos anexos -->
                            <div class="form-section" id="step4">
                                <h3 class="mb-4 border-bottom pb-2">Cargue de Documentos</h3>
                                <div class="row g-3">
                                    <div class="col-12" id="ZonaDocumentos">
                                        <!-- Aquí se generarán dinámicamente las tarjetas de documentos -->
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-primary btn-lg me-3" id="procesarDocumentos" onclick="procesarTodosLosDocumentos()">
                                                <i class="fas fa-cloud-upload-alt me-2"></i>
                                                Procesar Documentos (0/3)
                                            </button>
                                            <button type="button" class="btn btn-outline-warning" onclick="limpiarStorage()">
                                                <i class="fas fa-trash-alt me-2"></i>
                                                Limpiar Almacenamiento
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">Anterior</button>
                                <button type="button" class="btn btn-primary" id="nextBtn">Siguiente</button>
                                <button type="button" class="btn btn-warning" id="btnCodeudor" style="display: none;">Llenar Papeles del Codeudor</button>
                                <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">Enviar Solicitud</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @* aqui mi modal  *@

    <!-- Modal Informativa para monto mayor a 2 millones -->
    <div class="modal fade" id="modalCodeudor" tabindex="-1" aria-labelledby="modalCodeudorLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="modalCodeudorLabel">Información adicional requerida</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    El monto solicitado supera los <strong>$2.000.000</strong>. <br>
                    Por favor, completa la información del <strong>codeudor</strong> para continuar con tu solicitud.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>

    @* modal para codeudor *@

    <!-- Modal del Codeudor -->
    <div class="modal fade" id="modalCodeudorFormulario" tabindex="-1" aria-labelledby="modalCodeudorLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalCodeudorLabel"><i class="fas fa-user-friends me-2"></i> Información del Codeudor</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="formCodeudor">
                        <div class="row g-3">

                            <!-- Nombre y Apellido -->
                            <div class="col-md-6">
                                <label for="pNombreCodeudor" class="form-label">Primer Nombre *</label>
                                <input type="text" class="form-control" id="pNombreCodeudor" required>
                            </div>
                            <div class="col-md-6">
                                <label for="sNombreCodeudor" class="form-label">Segundo Nombre</label>
                                <input type="text" class="form-control" id="sNombreCodeudor">
                            </div>

                            <div class="col-md-6">
                                <label for="pApellidoCodeudor" class="form-label">Primer Apellido *</label>
                                <input type="text" class="form-control" id="pApellidoCodeudor" required>
                            </div>
                            <div class="col-md-6">
                                <label for="sApellidoCodeudor" class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" id="sApellidoCodeudor">
                            </div>

                            <!-- Tipo y Número de Identificación -->
                            <div class="col-md-6">
                                <label for="tipoIdentificacionCodeudor" class="form-label">Tipo de Identificación *</label>
                                <select class="form-select" id="tipoIdentificacionCodeudor" required>
                                    <option value="">Seleccione...</option>
                                    <option value="1">Cédula de Ciudadanía</option>
                                    <option value="2">Cédula de Extranjería</option>
                                    <option value="3">Pasaporte</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="numeroIdentificacionCodeudor" class="form-label">Número de Identificación *</label>
                                <input type="number" class="form-control" id="numeroIdentificacionCodeudor" required>
                            </div>

                            <!-- Dirección, Email, Celular -->
                            <div class="col-md-6">
                                <label for="direccionCodeudor" class="form-label">Dirección *</label>
                                <input type="text" class="form-control" id="direccionCodeudor" required>
                            </div>

                            <div class="col-md-6">
                                <label for="emailCodeudor" class="form-label">Correo Electrónico *</label>
                                <input type="email" class="form-control" id="emailCodeudor" required>
                            </div>

                            <div class="col-md-6">
                                <label for="celularCodeudor" class="form-label">Celular *</label>
                                <input type="tel" class="form-control" id="celularCodeudor" required>
                            </div>

                        </div>

                        <!-- Documentos del codeudor -->
                        <hr class="my-4">
                        <h5 class="mb-3">Documentos del Codeudor</h5>

                        <div class="row g-3">
                            <div class="col-12" id="zonaDocumentosCodeudor">
                                <!-- Aquí se cargan las tarjetas como en el paso 4 -->
                            </div>

                            <div class="col-12 text-center mt-3">
                                <button type="button" class="btn btn-primary btn-lg me-3" onclick="procesarDocumentosCodeudor()">
                                    <i class="fas fa-cloud-upload-alt me-2"></i> Procesar Documentos Codeudor
                                </button>
                                <button type="button" class="btn btn-outline-danger" onclick="limpiarDocumentosCodeudor()">
                                    <i class="fas fa-trash-alt me-2"></i> Limpiar Documentos
                                </button>
                            </div>
                        </div>

                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="guardarCodeudor()">
                        <i class="fas fa-save me-2"></i> Guardar Codeudor
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>


    @* <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> *@
    <script src="~/lib/sweetalert2@11.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap5.0.2.bundle.min.js"></script>
    <script src="~/lib/soliciud/js/registro.js"></script>
    <script>
            const documentosRequeridos = @Html.Raw(Json.Serialize(ViewData["DocumentosRequeridos"] ?? new List<Respuesta_Consulta_Documentos_Requeridos>()));
    </script>    
    <script src="~/js/carguedocumentos.js"></script>
   
</body>
</html>